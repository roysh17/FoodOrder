@using FoodOrder.Repository.Dtos.Orders;

<div class="container-fluid px-4">
    <h1 class="mt-4">Detail Pesanan</h1>

    <div class="card mb-4">

        <div class="card-body">

            <div class="row col-12">

                @{
                    var order = (Order)ViewData["order"];
                }

                <div>
                    <div class="row mb-3">
                        <div class="col-md-2">
                            <b>Order No</b>
                        </div>
                        <div class="col-md-4">
                            @order.OrderNo
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-2">
                            <b>Order Date</b>
                        </div>
                        <div class="col-md-4">
                            @order.OrderDate.ToString("yyyy-MM-dd")
                        </div>
                    </div>                  
                    <div class="row mb-3">
                        <div class="col-md-2">
                            <b>Customer Name</b>
                        </div>
                        <div class="col-md-4">
                            @order.CustomerName
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-2">
                            <b>Payment Status</b>
                        </div>
                        <div class="col-md-4">
                            @if (order.PaidStatus.ToLower() == "lunas")
                            {
                                <span class="text-success">@order.PaidStatus</span>
                            }
                            else
                            {
                                <span class="text-danger">@order.PaidStatus</span>
                            }
                        </div>
                    </div>
                </div>
                <div>
                    <table id="dataTable1" class="table table-striped table-bordered dt-responsive nowrap" width="100%" cellspacing="0">
                        <thead>
                            <tr>
                                <th>Item Name</th>
                                <th>Item Price (Rp)</th>
                                <th>Quantity</th>
                                <th>Total Price (Rp)</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in (List<OrderItem>)ViewData["orderItems"])
                            {
                                <tr>
                                    <td>@item.FoodName</td>
                                    <td>@item.ItemPrice</td>
                                    <td>@item.Qty</td>
                                    <td>@item.TotalPrice</td>
                                </tr>
                            }
                        </tbody>

                    </table>
                </div>

                @if (TempData["ErrorMessage"] != null)
                {
                    <center class="text-danger">@TempData["ErrorMessage"]</center>
                }

                <form method="post" action="/orders/updatePaymentStatus">

                    <input type="hidden" name="orderId" value="@order.OrderId" />
                    <div>
                        <div class="row mb-3">
                            <div class="col-md-2">
                                <b>Total Price</b>
                            </div>
                            <div class="col-md-4">
                                @order.TotalPrice
                            </div>
                        </div>
                    </div>
                    @if (!order.IsPaid)
                    {
                        <div>
                            <div class="row mb-3">
                                <div class="col-md-2">
                                    <b>Total Payment</b>
                                </div>
                                <div class="col-md-4">
                                    <input type="number" class="form-control" id="totalPayment" name="totalPayment" onkeyup="validateTotalPayment(this.value);" />
                                    <small class="text-danger">Total payment = Total Price</small>
                                </div>
                            </div>
                        </div>

                        <div>
                            <button id="btnSubmitPayment" type="submit" href="/orders" class="btn btn-primary" disabled="disabled"
                            onclick="return confirm('Apakah yakin untuk melanjutkan proses pembayaran?')">
                                Submit Payment
                            </button>
                            <a href="/orders" class="btn btn-secondary">Pending (belum bayar)</a>
                        </div>
                    }else
                    {
                        <a href="/orders" class="btn btn-secondary">Back</a>
                    }                    
                </form>
            </div>
        </div>
    </div>
</div>



@section Scripts {

    <script src="~/lib/jquery/dist/jquery.min.js"></script>

    <script>
        function validateTotalPayment(paymentVal) {
            if (parseInt(paymentVal) == parseInt('@order.TotalPrice')) {
                $("#btnSubmitPayment").attr('disabled', false);
            } else {
                $("#btnSubmitPayment").attr('disabled', true);
            }
        }
    </script>
}